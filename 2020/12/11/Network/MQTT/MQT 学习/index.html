<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"snowyang.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="MQTT å­¦ä¹ ç¬”è®°ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="MQT å­¦ä¹ ">
<meta property="og:url" content="https://snowyang.com/2020/12/11/Network/MQTT/MQT%20%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="å†·é¦™å°ç­‘">
<meta property="og:description" content="MQTT å­¦ä¹ ç¬”è®°ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-12-11T12:01:32.275Z">
<meta property="article:modified_time" content="2020-12-11T12:01:32.275Z">
<meta property="article:author" content="Snow Yang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://snowyang.com/2020/12/11/Network/MQTT/MQT%20%E5%AD%A6%E4%B9%A0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MQT å­¦ä¹  | å†·é¦™å°ç­‘</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c946d75c051cf3fd9b2873d44f7a553e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">å†·é¦™å°ç­‘</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Snow Yang çš„åšå®¢</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://snowyang.com/2020/12/11/Network/MQTT/MQT%20%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Snow Yang">
      <meta itemprop="description" content="åƒå¤é£æµä»Šåœ¨æ­¤ï¼Œä¸‡é‡ŒåŠŸåè«æ”¾ä¼‘">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å†·é¦™å°ç­‘">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MQT å­¦ä¹ 
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-12-11 20:01:32" itemprop="dateCreated datePublished" datetime="2020-12-11T20:01:32+08:00">2020-12-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MQTT/" itemprop="url" rel="index"><span itemprop="name">MQTT</span></a>
                </span>
            </span>

          
            <span id="/2020/12/11/Network/MQTT/MQT%20%E5%AD%A6%E4%B9%A0/" class="post-meta-item leancloud_visitors" data-flag-title="MQT å­¦ä¹ " title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>MQTT å­¦ä¹ ç¬”è®°ã€‚</p>
<a id="more"></a>

<h2 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/20888181">MQTTå…¥é—¨ç¯‡</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1553c1686337">MQTT example</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/github_33304260/article/details/73562071">MQTTæœåŠ¡å™¨Mosquittoå®‰è£…åŠä½¿ç”¨</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mqtt/mqtt.github.io/wiki/libraries">libraries</a></p>
<p>[MQTT Essentials â€“ A Lightweight IoT Protocol](../resources/MQTT Essentials â€“ A Lightweight IoT Protocol.epub) â€” Good Book !!! ğŸ‚</p>
<p>MQTT æ˜¯ç§åŸºäº<code>è®¢é˜…-å‘å¸ƒ</code>æœºåˆ¶çš„<code>å¼‚æ­¥</code>é€šä¿¡æŠ€æœ¯ï¼Œæ ¸å¿ƒæ˜¯<code>è§£è€¦</code>ã€‚</p>
<p>è§£è€¦(Decouple)æ˜¯ [MQTT Essentials â€“ A Lightweight IoT Protocol](resources/MQTT Essentials â€“ A Lightweight IoT Protocol.epub) å†…åå¤å¤šæ¬¡æåˆ°çš„ä¸€ä¸ªè¯ ã€‚</p>
<blockquote>
<h3 id="å‘å¸ƒ-è®¢é˜…æ¨¡å¼-Publish-subscribe-pattern"><a href="#å‘å¸ƒ-è®¢é˜…æ¨¡å¼-Publish-subscribe-pattern" class="headerlink" title="å‘å¸ƒ/è®¢é˜…æ¨¡å¼(Publish-subscribe pattern)"></a>å‘å¸ƒ/è®¢é˜…æ¨¡å¼(Publish-subscribe pattern)</h3><p>ä¸è¯·æ±‚/å›ç­”è¿™ç§åŒæ­¥æ¨¡å¼ä¸åŒï¼Œå‘å¸ƒ/å®šä¹‰æ¨¡å¼è§£è€¦äº†å‘å¸ƒæ¶ˆæ¯çš„å®¢æˆ·ï¼ˆå‘å¸ƒè€…ï¼‰ä¸è®¢é˜…æ¶ˆæ¯çš„å®¢æˆ·ï¼ˆè®¢é˜…è€…ï¼‰ä¹‹é—´çš„å…³ç³»ï¼Œè¿™æ„å‘³ç€å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´å¹¶ä¸éœ€è¦ç›´æ¥å»ºç«‹è”ç³»ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œä½ æ‰“ç”µè¯ç»™æœ‹å‹ï¼Œä¸€ç›´è¦ç­‰åˆ°æœ‹å‹æ¥ç”µè¯äº†æ‰èƒ½å¤Ÿå¼€å§‹äº¤æµï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„åŒæ­¥è¯·æ±‚/å›ç­”çš„åœºæ™¯ï¼›è€Œç»™ä¸€ä¸ªå¥½å‹é‚®ä»¶åˆ—è¡¨å‘ç”µå­é‚®ä»¶å°±ä¸ä¸€æ ·ï¼Œä½ å‘å¥½ç”µå­é‚®ä»¶è¯¥å¹²å˜›å¹²å˜›ï¼Œå¥½å‹ä»¬åˆ°æœ‰ç©ºäº†å»æŸ¥çœ‹é‚®ä»¶å°±æ˜¯äº†ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„å¼‚æ­¥å‘å¸ƒ/è®¢é˜…çš„åœºæ™¯ã€‚</p>
<p>ç†Ÿæ‚‰ç¼–ç¨‹çš„åŒå­¦ä¸€å®šéå¸¸ç†Ÿæ‚‰è¿™ç§è®¾è®¡æ¨¡å¼äº†ï¼Œå› ä¸ºå®ƒå¸¦æ¥äº†è¿™äº›å¥½å¤„ï¼š</p>
<ul>
<li>å‘å¸ƒè€…ä¸è®¢é˜…è€…ä¸å¿…äº†è§£å½¼æ­¤ï¼Œåªè¦è®¤è¯†åŒä¸€ä¸ªæ¶ˆæ¯ä»£ç†å³å¯ã€‚</li>
<li>å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¸éœ€è¦äº¤äº’ï¼Œå‘å¸ƒè€…æ— éœ€ç­‰å¾…è®¢é˜…è€…ç¡®è®¤è€Œå¯¼è‡´é”å®šã€‚</li>
<li>å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¸éœ€è¦åŒæ—¶åœ¨çº¿ï¼Œå¯ä»¥è‡ªç”±é€‰æ‹©æ—¶é—´æ¥æ¶ˆè´¹æ¶ˆæ¯ã€‚</li>
</ul>
<h3 id="ä¸»é¢˜-Topic"><a href="#ä¸»é¢˜-Topic" class="headerlink" title="ä¸»é¢˜(Topic)"></a>ä¸»é¢˜(Topic)</h3><p>MQTTæ˜¯é€šè¿‡ä¸»é¢˜å¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç±»çš„ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªUTF-8çš„å­—ç¬¦ä¸²ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡åæ–œæ è¡¨ç¤ºå¤šä¸ªå±‚çº§å…³ç³»ã€‚ä¸»é¢˜å¹¶ä¸éœ€è¦åˆ›å»ºï¼Œç›´æ¥ä½¿ç”¨å°±æ˜¯äº†ã€‚</p>
<p>ä¸»é¢˜è¿˜å¯ä»¥é€šè¿‡é€šé…ç¬¦è¿›è¡Œè¿‡æ»¤ã€‚å…¶ä¸­ï¼Œ+å¯ä»¥è¿‡æ»¤ä¸€ä¸ªå±‚çº§ï¼Œè€Œ*åªèƒ½å‡ºç°åœ¨ä¸»é¢˜æœ€åè¡¨ç¤ºè¿‡æ»¤ä»»æ„çº§åˆ«çš„å±‚çº§ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>building-b/floor-5ï¼šä»£è¡¨Bæ¥¼5å±‚çš„è®¾å¤‡ã€‚</li>
<li>+/floor-5ï¼šä»£è¡¨ä»»ä½•ä¸€ä¸ªæ¥¼çš„5å±‚çš„è®¾å¤‡ã€‚</li>
<li>building-b/*ï¼šä»£è¡¨Bæ¥¼æ‰€æœ‰çš„è®¾å¤‡ã€‚</li>
</ul>
<p>æ³¨æ„ï¼ŒMQTTå…è®¸ä½¿ç”¨é€šé…ç¬¦è®¢é˜…ä¸»é¢˜ï¼Œä½†æ˜¯å¹¶ä¸å…è®¸ä½¿ç”¨é€šé…ç¬¦å¹¿æ’­ã€‚</p>
</blockquote>
<h2 id="é—è¨€æœºåˆ¶-Last-will"><a href="#é—è¨€æœºåˆ¶-Last-will" class="headerlink" title="é—è¨€æœºåˆ¶(Last will)"></a>é—è¨€æœºåˆ¶(Last will)</h2><p>é—è¨€æœºåˆ¶å¯ä»¥è®©è®¢é˜…è€…çŸ¥é“è®¾å¤‡å¼‚å¸¸ç¦»çº¿ï¼Œæœ€é‡è¦çš„æ˜¯ç¦»çº¿åè¦åšä»€ä¹ˆæ“ä½œï¼Œè¿™ä¹Ÿæ˜¯é—è¨€çš„ç°å®æ„ä¹‰ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000007266638">https://segmentfault.com/a/1190000007266638</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/17270863/mqtt-what-is-the-purpose-or-usage-of-last-will-testament/17385293#17385293">https://stackoverflow.com/questions/17270863/mqtt-what-is-the-purpose-or-usage-of-last-will-testament/17385293#17385293</a></p>
<blockquote>
<p>Iâ€™m surely missing something about how the whole MQTT protocol works, as I canâ€™t grasp the usage pattern of <em>Last Will Testament</em> messages: whatâ€™s their purpose?<br>One example I often see is about informing that a device has gone offline. It doesnâ€™t make very much sense to me, since itâ€™s obvious that if a device isnâ€™t publishing any data it may be offline or there could be some network problems.</p>
<p>So, what are some practical usages of the LWT? What was it invented for?</p>
<hr>
<p>LWT messages are not really concerned about detecting whether a client has gone offline or not (that task is handled by keepAlive messages). LWT messages are about <strong>what happens after the client has gone offline</strong>. </p>
<p>The analogy is that of a <em>real</em> last will: If a person dies, she can formulate a testament, in which she declares what actions should be taken after she has passed away. An executor will heed those wishes and execute them on her behalf. The analogy in the MQTT world is that a client can formulate a testament, in which it declares what message should be sent on itâ€™s behalf by the broker, after it has gone offline.</p>
<p><strong>A fictitious example:</strong></p>
<p>I have a sensor, which sends crucial data, but very infrequently. It has formulated a last will statement in the form of [topic: â€˜/node/gone-offlineâ€™, message: â€˜:idâ€™], with :id being a unique id for the sensor. I also have a <em>emergency-subscriber</em> for the topic â€˜node/gone-offlineâ€™, which will send a SMS to my phone every time a message is published on that channel.</p>
<p>During normal operation, the sensor will keep the connection to the MQTT-broker open by sending periodic keepAlive messages interspersed with the actual sensor readings. If the sensor goes offline, the connection to the broker will time out, due to the lack of keepAlives. </p>
<p>This is where LWT comes in: If no LWT is specified, the broker doesnâ€™t care and just closes the connection. In our case however, the broker will execute the sensorâ€™s last will and publish the LWT-message â€˜/node/gone-offline: :idâ€™. The message will then be consumed to my <em>emergency-subscriber</em>and I will be notified of the sensorâ€™s ID via SMS so that I can check up on whatâ€™s going on.</p>
<p><strong>In short:</strong></p>
<p>Instead of just closing the connection after a client has gone offline, LWT messages can be leveraged to define a message to be published by the broker on behalf of the client, since the client is offline and cannot publish anymore.</p>
<p>Furthermore, keepAlive messages are only sent and received by the broker and thereâ€™s the main difference with the Last Will: anyone can suscribe to this topic and be aware of the client going offline</p>
</blockquote>
<h2 id="å»ºç«‹è¿æ¥"><a href="#å»ºç«‹è¿æ¥" class="headerlink" title="å»ºç«‹è¿æ¥"></a>å»ºç«‹è¿æ¥</h2><p>page 69</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Client            Server</span><br><span class="line">   |--- CONNECT ---&gt;|</span><br><span class="line">   |&lt;-- CONNACK ----|</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
        <div class="reward-container">
  <div>åšæŒåŸåˆ›æŠ€æœ¯åˆ†äº«ï¼Œæ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="Snow Yang å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Snow Yang æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>

  </div>
</div>


      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/12/11/Complie%20&%20Debug/GCC/GCC%20%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF/" rel="prev" title="GCC å¸¸è§é”™è¯¯">
      <i class="fa fa-chevron-left"></i> GCC å¸¸è§é”™è¯¯
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/11/Network/MQTT/mosquitto/" rel="next" title="mosquitto">
      mosquitto <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A5%E9%97%A8"><span class="nav-number">1.</span> <span class="nav-text">å…¥é—¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F-Publish-subscribe-pattern"><span class="nav-number">1.1.</span> <span class="nav-text">å‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼(Publish-subscribe pattern)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E9%A2%98-Topic"><span class="nav-number">1.2.</span> <span class="nav-text">ä¸»é¢˜(Topic)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%97%E8%A8%80%E6%9C%BA%E5%88%B6-Last-will"><span class="nav-number">2.</span> <span class="nav-text">é—è¨€æœºåˆ¶(Last will)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5"><span class="nav-number">3.</span> <span class="nav-text">å»ºç«‹è¿æ¥</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Snow Yang"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Snow Yang</p>
  <div class="site-description" itemprop="description">åƒå¤é£æµä»Šåœ¨æ­¤ï¼Œä¸‡é‡ŒåŠŸåè«æ”¾ä¼‘</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/smartsnow" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;smartsnow" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Snow Yang</span>
</div>
  <!-- <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div>
  -->

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"PV6nn46hGfP8NYx7WwzusM8C-9Nh9j0Va","app_key":"icEREPKf8nKewGksI1Nw6KrM","server_url":null,"security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
